(function($){$.fn.stickytable=function(options){var _jq=this;var $this;_jq.settings={};_jq.table={};var defaults={stick_header:true,stick_footer:false,offset_height:0,original_header_class_name:"original-header",original_footer_class_name:"original-footer",cloned_header_class_name:"sticky-header",cloned_footer_class_name:"sticky-footer"};_jq.settings=$.extend({},defaults,options);_jq.init=function(table){if(undefined==$(table).data("$sticky_header")){_setup(table);}$(window).scroll(function(e){var scrollTop=$(window).scrollTop();_scroll(scrollTop,table);}).trigger("scroll");};var _setup=function(table){_set_table_scope(table);_set_objects(table);_get_dimensions(table);_resize_columns(table);_set_styling(table);var initial_scrollTop=$(window).scrollTop();if(initial_scrollTop>0){_scroll(initial_scrollTop,table);}if("function"==typeof $(window).smartresize){console.log("smart resize detected",$(table));$(window).smartresize(function(){console.log("smart resizing");_do_resize(table);});}else{console.log("smart resize not detected");$(window).resize(function(){console.log("resizing");_do_resize(table);});}};var _do_resize=function(table){_set_table_scope(table);_get_dimensions(table);_resize_columns(table);_set_styling(table);_scroll($(window).scrollTop(),table);};var _set_table_scope=function(table){$this=$(table);};var _set_objects=function(table){if(true===_jq.settings.stick_header){$(table).data("$header",$("thead",$this));_jq.$header_clone=$(table).data("$header").clone(true);_jq.$header_clone.addClass(_jq.settings.cloned_header_class_name);$(table).data("$header").addClass(_jq.settings.original_header_class_name).after(_jq.$header_clone);$(table).data("$sticky_header",$(table).data("$header").siblings("."+_jq.settings.cloned_header_class_name));}if(true===_jq.settings.stick_footer){$(table).data("$footer",$("tfoot",$this));_jq.$footer_clone=$(table).data("$footer").clone(true);_jq.$footer_clone.addClass(_jq.settings.cloned_footer_class_name);$(table).data("$footer").addClass(_jq.settings.original_footer_class_name).after(_jq.$footer_clone);$(table).data("$sticky_footer",$(table).data("$footer").siblings("."+_jq.settings.cloned_footer_class_name));}};var _get_dimensions=function(table){if(true===_jq.settings.stick_header){$(table).data("header_outer_height",$(table).data("$header").outerHeight());$(table).data("header_width",$(table).data("$header").width());$(table).data("header_offset",$(table).data("$header").offset());$(table).data("sticky_header_outer_height",$(table).data("$sticky_header").outerHeight());$(table).data("sticky_header_offset",$(table).data("$sticky_header").offset());}if(true===_jq.settings.stick_footer){$(table).data("footer_outer_height",$(table).data("$footer").outerHeight());$(table).data("footer_width",$(table).data("$footer").width());$(table).data("footer_offset",$(table).data("$footer").offset());$(table).data("sticky_footer_outer_height",$(table).data("$sticky_footer").outerHeight());$(table).data("sticky_footer_offset",$(table).data("$sticky_footer").offset());}$(table).data("$last_row",$("> tbody > tr:last",$this));$(table).data("last_row_offset",$(table).data("$last_row").offset());$(table).data("last_row_height",$(table).data("$last_row").outerHeight());console.groupCollapsed("Saved data for",$(table));console.log("$header",$("thead",$this));console.log("$last_row",$(table).data("$last_row"));console.log("last_row_offset",$(table).data("$last_row").offset());console.log("last_row_height",$(table).data("$last_row").outerHeight());console.groupEnd();};var _set_styling=function(table){if(true===_jq.settings.stick_header){$(table).data("$sticky_header").css({position:"fixed",top:$(table).data("header_offset").top,overflow:"hidden",width:$(table).data("header_width"),display:"none","z-index":100});}if(true===_jq.settings.stick_footer){$(table).data("$sticky_footer").css({position:"fixed",top:$(table).data("footer_offset").top,overflow:"hidden",width:$(table).data("footer_width"),display:"none","z-index":90});}};var _resize_columns=function(table){if(true===_jq.settings.stick_header){$("th",$(table).data("$header")).each(function(index,element){var $sticky_header_children=$("th",$(table).data("$sticky_header"));var $sticky_header_child=$sticky_header_children.eq(index);$sticky_header_child.outerWidth($(element).outerWidth());});}if(true===_jq.settings.stick_footer){$("td",$(table).data("$footer")).each(function(index,element){var $sticky_footer_children=$("td",$(table).data("$sticky_footer"));var $sticky_footer_child=$sticky_footer_children.eq(index);$sticky_footer_child.outerWidth($(element).outerWidth());});}};var _scroll=function(scrollTop,table){if(true===_jq.settings.stick_header){_scroll_header(scrollTop,table);}if(true===_jq.settings.stick_footer){_scroll_footer(scrollTop,table);}};var _default_scroll=function($org_elem,$sticky_elem){$org_elem.css({visibility:"visible"});$sticky_elem.hide();};var _scroll_header=function(scrollTop,table){var position="fixed";var stop=0;var offset=_jq.settings.offset_height;var header_offset_top=$(table).data("header_offset").top;var header_height=$(table).data("header_outer_height");var sticky_header_height=$(table).data("sticky_header_outer_height");var last_row_height=$(table).data("last_row_height");var last_row_offset_top=$(table).data("last_row_offset").top;if((scrollTop+offset>header_offset_top)&&scrollTop+offset+header_height<last_row_offset_top-sticky_header_height){stop=offset;$(table).data("$header").css({visibility:"hidden"});$(table).data("$sticky_header").show();}else{if(scrollTop+offset+header_height>=last_row_offset_top-sticky_header_height){position="absolute";stop=last_row_offset_top-header_height-sticky_header_height;}else{_default_scroll($(table).data("$header"),$(table).data("$sticky_header"));}}$(table).data("$sticky_header").css({position:position,top:stop+"px"});};var _scroll_footer=function(scrollTop,table){var $footer=$(table).data("$footer");var $sticky_footer=$(table).data("$sticky_footer");var position="fixed";var stop=0;var viewport_height=$(window).height();var tbody_height=$("tbody",table).outerHeight();var footer_height=$(table).data("footer_outer_height");var table_height=tbody_height+footer_height;if(true===_jq.settings.stick_header){table_height+=$(table).data("header_outer_height");}var table_offset=$(table).offset();var sticky_footer_height=$(table).data("sticky_footer_outer_height");var last_row_offset_bottom=$(table).data("last_row_offset").top+$(table).data("last_row_height");if(table_height>viewport_height&&scrollTop>table_offset.top){if(table_height-(scrollTop-table_offset.top)>viewport_height&&last_row_offset_bottom-scrollTop>viewport_height-sticky_footer_height){stop=viewport_height-sticky_footer_height;$(table).data("$footer").css({visibility:"hidden"});$(table).data("$sticky_footer").show();}else{_default_scroll($footer,$sticky_footer);}}else{_default_scroll($footer,$sticky_footer);}$(table).data("$sticky_footer").css({position:position,top:stop+"px"});};return this.each(function(i,table){_jq.init(table);});};})(jQuery);