(function(a){a.fn.stickytable=function(b){var c=this;var d;c.settings={};c.table={};var e={stick_header:true,stick_footer:false,offset_height:0,original_header_class_name:"original-header",original_footer_class_name:"original-footer",cloned_header_class_name:"sticky-header",cloned_footer_class_name:"sticky-footer"};c.settings=a.extend({},e,b);c.init=function(b){if(undefined==a(b).data("$sticky_header")){f(b)}a(window).scroll(function(c){var d=a(window).scrollTop();m(d,b)}).trigger("scroll")};var f=function(b){h(b);i(b);j(b);l(b);k(b);var c=a(window).scrollTop();if(c>0){m(c,b)}if("function"==typeof a(window).smartresize){console.log("smart resize detected",a(b));a(window).smartresize(function(){console.log("smart resizing");g(b)})}else{console.log("smart resize not detected");a(window).resize(function(){console.log("resizing");g(b)})}};var g=function(b){h(b);j(b);l(b);k(b);m(a(window).scrollTop(),b)};var h=function(b){d=a(b)};var i=function(b){if(true===c.settings.stick_header){a(b).data("$header",a("thead",d));c.$header_clone=a(b).data("$header").clone(true);c.$header_clone.addClass(c.settings.cloned_header_class_name);a(b).data("$header").addClass(c.settings.original_header_class_name).after(c.$header_clone);a(b).data("$sticky_header",a(b).data("$header").siblings("."+c.settings.cloned_header_class_name))}if(true===c.settings.stick_footer){a(b).data("$footer",a("tfoot",d));c.$footer_clone=a(b).data("$footer").clone(true);c.$footer_clone.addClass(c.settings.cloned_footer_class_name);a(b).data("$footer").addClass(c.settings.original_footer_class_name).after(c.$footer_clone);a(b).data("$sticky_footer",a(b).data("$footer").siblings("."+c.settings.cloned_footer_class_name))}};var j=function(b){if(true===c.settings.stick_header){a(b).data("header_outer_height",a(b).data("$header").outerHeight());a(b).data("header_width",a(b).data("$header").width());a(b).data("header_offset",a(b).data("$header").offset());a(b).data("sticky_header_outer_height",a(b).data("$sticky_header").outerHeight());a(b).data("sticky_header_offset",a(b).data("$sticky_header").offset())}if(true===c.settings.stick_footer){a(b).data("footer_outer_height",a(b).data("$footer").outerHeight());a(b).data("footer_width",a(b).data("$footer").width());a(b).data("footer_offset",a(b).data("$footer").offset());a(b).data("sticky_footer_outer_height",a(b).data("$sticky_footer").outerHeight());a(b).data("sticky_footer_offset",a(b).data("$sticky_footer").offset())}a(b).data("$last_row",a("> tbody > tr:last",d));a(b).data("last_row_offset",a(b).data("$last_row").offset());a(b).data("last_row_height",a(b).data("$last_row").outerHeight());console.groupCollapsed("Saved data for",a(b));console.log("$header",a("thead",d));console.log("$last_row",a(b).data("$last_row"));console.log("last_row_offset",a(b).data("$last_row").offset());console.log("last_row_height",a(b).data("$last_row").outerHeight());console.groupEnd()};var k=function(b){if(true===c.settings.stick_header){a(b).data("$sticky_header").css({position:"fixed",top:a(b).data("header_offset").top,overflow:"hidden",width:a(b).data("header_width"),display:"none","z-index":100})}if(true===c.settings.stick_footer){a(b).data("$sticky_footer").css({position:"fixed",top:a(b).data("footer_offset").top,overflow:"hidden",width:a(b).data("footer_width"),display:"none","z-index":90})}};var l=function(b){if(true===c.settings.stick_header){a("th",a(b).data("$header")).each(function(c,d){var e=a("th",a(b).data("$sticky_header"));var f=e.eq(c);f.outerWidth(a(d).outerWidth())})}if(true===c.settings.stick_footer){a("td",a(b).data("$footer")).each(function(c,d){var e=a("td",a(b).data("$sticky_footer"));var f=e.eq(c);f.outerWidth(a(d).outerWidth())})}};var m=function(a,b){if(true===c.settings.stick_header){o(a,b)}if(true===c.settings.stick_footer){p(a,b)}};var n=function(a,b){a.css({visibility:"visible"});b.hide()};var o=function(b,d){var e="fixed";var f=0;var g=c.settings.offset_height;var h=a(d).data("header_offset").top;var i=a(d).data("header_outer_height");var j=a(d).data("sticky_header_outer_height");var k=a(d).data("last_row_height");var l=a(d).data("last_row_offset").top;if(b+g>h&&b+g+i<l-j){f=g;a(d).data("$header").css({visibility:"hidden"});a(d).data("$sticky_header").show()}else if(b+g+i>=l-j){e="absolute";f=l-i-j}else{n(a(d).data("$header"),a(d).data("$sticky_header"))}a(d).data("$sticky_header").css({position:e,top:f+"px"})};var p=function(b,d){var e=a(d).data("$footer");var f=a(d).data("$sticky_footer");var g="fixed";var h=0;var i=a(window).height();var j=a("tbody",d).outerHeight();var k=a(d).data("footer_outer_height");var l=j+k;if(true===c.settings.stick_header){l+=a(d).data("header_outer_height")}var m=a(d).offset();var o=a(d).data("sticky_footer_outer_height");var p=a(d).data("last_row_offset").top+a(d).data("last_row_height");if(l>i&&b>m.top){if(l-(b-m.top)>i&&p-b>i-o){h=i-o;a(d).data("$footer").css({visibility:"hidden"});a(d).data("$sticky_footer").show()}else{n(e,f)}}else{n(e,f)}a(d).data("$sticky_footer").css({position:g,top:h+"px"})};return this.each(function(a,b){c.init(b)})}})(jQuery)